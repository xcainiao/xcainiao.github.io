(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{360:function(a,f,e){"use strict";e.r(f);var n=e(1),t=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var a=this,f=a.$createElement,e=a._self._c||f;return e("div",{staticClass:"content"},[e("h2",{attrs:{id:"git-log"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#git-log","aria-hidden":"true"}},[a._v("#")]),a._v(" git log")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("commit 50835f2bb5cac36af1f816c8e2830b699260f95d\nAuthor: hellerve <veit@veitheller.de>\nDate:   Thu Mar 8 17:46:01 2018 +0100\n\n    editor: correctly free line when opening file\n")])])]),e("h2",{attrs:{id:"error"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#error","aria-hidden":"true"}},[a._v("#")]),a._v(" error")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("==2851==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x61d00001ea7f at pc 0x00000040d428 bp 0x7ffd417b66f0 sp 0x7ffd417b66e0\nWRITE of size 1 at 0x61d00001ea7f thread T0\n    #0 0x40d427 in syntax_read_file src/syntax.c:126\n    #1 0x40d5d0 in syntax_init src/syntax.c:174\n    #2 0x401d69 in main /home/fuzz/github/e_bak/main.c:49\n    #3 0x7f32df71e82f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f)\n    #4 0x401fc8 in _start (/home/fuzz/github/e_bak/bin/e+0x401fc8)\n\n0x61d00001ea7f is located 1 bytes to the left of 2048-byte region [0x61d00001ea80,0x61d00001f280)\nallocated by thread T0 here:\n    #0 0x7f32dfb60602 in malloc (/usr/lib/x86_64-linux-gnu/libasan.so.2+0x98602)\n    #1 0x40d17e in syntax_read_file src/syntax.c:109\n\nSUMMARY: AddressSanitizer: heap-buffer-overflow src/syntax.c:126 syntax_read_file\nShadow bytes around the buggy address:\n  0x0c3a7fffbcf0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c3a7fffbd00: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c3a7fffbd10: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c3a7fffbd20: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n  0x0c3a7fffbd30: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa\n=>0x0c3a7fffbd40: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa[fa]\n  0x0c3a7fffbd50: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n  0x0c3a7fffbd60: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n  0x0c3a7fffbd70: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n  0x0c3a7fffbd80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\n  0x0c3a7fffbd90: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00\nShadow byte legend (one shadow byte represents 8 application bytes):\n  Addressable:           00\n  Partially addressable: 01 02 03 04 05 06 07\n  Heap left redzone:       fa\n  Heap right redzone:      fb\n  Freed heap region:       fd\n  Stack left redzone:      f1\n  Stack mid redzone:       f2\n  Stack right redzone:     f3\n  Stack partial redzone:   f4\n  Stack after return:      f5\n  Stack use after scope:   f8\n  Global redzone:          f9\n  Global init order:       f6\n  Poisoned by user:        f7\n  Container overflow:      fc\n  Array cookie:            ac\n  Intra object redzone:    bb\n  ASan internal:           fe\n==2851==ABORTING\n")])])]),e("p",[a._v("testcase:https://github.com/xcainiao/poc/blob/master/e_heap-buffer-overflow_syntax_read_file.stx")]),a._v(" "),e("h2",{attrs:{id:"analysis"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#analysis","aria-hidden":"true"}},[a._v("#")]),a._v(" analysis")]),a._v(" "),e("ul",[e("li",[a._v("fgets not return NULL")]),a._v(" "),e("li",[a._v("strlen return 0")]),a._v(" "),e("li",[a._v("ln =-1")])]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("while (fgets(line, MAX_LINE_WIDTH, f)) {\n    lineno++;\n    ln = strlen(line)-1;\n    line[ln] = '\\0';                 //error\n}\n")])])]),e("p",[a._v("构造只包含\\x00的文件，触发漏洞。\n测试程序")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('#include <stdio.h>\nvoid main()\n{\n        FILE *f;\n        char line[1024];\n        char *res;\n        printf("%x\\n", line);\n        f = fopen("./tmp.txt", "r");\n        res = fgets(line, 1024, f);\n        printf("%x\\n", res);\n}\n')])])])])}],!1,null,null,null);f.default=t.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{357:function(e,n,i){"use strict";i.r(n);var a=i(1),s=Object(a.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var e=this,n=e.$createElement,i=e._self._c||n;return i("div",{staticClass:"content"},[i("p",[e._v("./flex ./flex_memory_leaks_in_xstrdup")]),e._v(" "),i("h2",{attrs:{id:"git-log"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#git-log","aria-hidden":"true"}},[e._v("#")]),e._v(" git log")]),e._v(" "),i("div",{staticClass:"language- extra-class"},[i("pre",{pre:!0,attrs:{class:"language-text"}},[i("code",[e._v("commit 60b578fdaab4bf8d95203caaa947b476eeb03c10\nAuthor: Simon Sobisch <simonsobisch@web.de>\nDate:   Fri Mar 16 21:53:48 2018 +0100\n\n    doc: describe mailing list usage in more detail\n")])])]),i("h2",{attrs:{id:"error"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#error","aria-hidden":"true"}},[e._v("#")]),e._v(" error")]),e._v(" "),i("div",{staticClass:"language- extra-class"},[i("pre",{pre:!0,attrs:{class:"language-text"}},[i("code",[e._v("==110424==ERROR: LeakSanitizer: detected memory leaks\n\nDirect leak of 2 byte(s) in 1 object(s) allocated from:\n    #0 0x7f320858230f in strdup (/usr/lib/x86_64-linux-gnu/libasan.so.2+0x6230f)\n    #1 0x420712 in xstrdup /home/fuzz/github/flex_o/src/misc.c:231\n    #2 0x435dd2 in ndinstal /home/fuzz/github/flex_o/src/sym.c:180\n    #3 0x441ee7 in flexscan scan.l:342\n    #4 0x43d4c0 in yylex /home/fuzz/github/flex_o/src/yylex.c:51\n    #5 0x427ca7 in yyparse /home/fuzz/github/flex_o/src/parse.c:1405\n    #6 0x41edea in readin /home/fuzz/github/flex_o/src/main.c:1490\n    #7 0x41af93 in flex_main /home/fuzz/github/flex_o/src/main.c:170\n    #8 0x41b282 in main /home/fuzz/github/flex_o/src/main.c:209\n    #9 0x7f3207e6d82f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f)\n\nDirect leak of 1 byte(s) in 1 object(s) allocated from:\n    #0 0x7f320858230f in strdup (/usr/lib/x86_64-linux-gnu/libasan.so.2+0x6230f)\n    #1 0x420712 in xstrdup /home/fuzz/github/flex_o/src/misc.c:231\n    #2 0x435dc3 in ndinstal /home/fuzz/github/flex_o/src/sym.c:180\n    #3 0x441ee7 in flexscan scan.l:342\n    #4 0x43d4c0 in yylex /home/fuzz/github/flex_o/src/yylex.c:51\n    #5 0x427ca7 in yyparse /home/fuzz/github/flex_o/src/parse.c:1405\n    #6 0x41edea in readin /home/fuzz/github/flex_o/src/main.c:1490\n    #7 0x41af93 in flex_main /home/fuzz/github/flex_o/src/main.c:170\n    #8 0x41b282 in main /home/fuzz/github/flex_o/src/main.c:209\n    #9 0x7f3207e6d82f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f)\n\nSUMMARY: AddressSanitizer: 3 byte(s) leaked in 2 allocation(s).\n\n=================================================================\n==110422==ERROR: LeakSanitizer: detected memory leaks\n\nDirect leak of 2 byte(s) in 1 object(s) allocated from:\n    #0 0x7f320858230f in strdup (/usr/lib/x86_64-linux-gnu/libasan.so.2+0x6230f)\n    #1 0x420712 in xstrdup /home/fuzz/github/flex_o/src/misc.c:231\n    #2 0x435dd2 in ndinstal /home/fuzz/github/flex_o/src/sym.c:180\n    #3 0x441ee7 in flexscan scan.l:342\n    #4 0x43d4c0 in yylex /home/fuzz/github/flex_o/src/yylex.c:51\n    #5 0x427ca7 in yyparse /home/fuzz/github/flex_o/src/parse.c:1405\n    #6 0x41edea in readin /home/fuzz/github/flex_o/src/main.c:1490\n    #7 0x41af93 in flex_main /home/fuzz/github/flex_o/src/main.c:170\n    #8 0x41b282 in main /home/fuzz/github/flex_o/src/main.c:209\n    #9 0x7f3207e6d82f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f)\n\nDirect leak of 1 byte(s) in 1 object(s) allocated from:\n    #0 0x7f320858230f in strdup (/usr/lib/x86_64-linux-gnu/libasan.so.2+0x6230f)\n    #1 0x420712 in xstrdup /home/fuzz/github/flex_o/src/misc.c:231\n    #2 0x435dc3 in ndinstal /home/fuzz/github/flex_o/src/sym.c:180\n    #3 0x441ee7 in flexscan scan.l:342\n    #4 0x43d4c0 in yylex /home/fuzz/github/flex_o/src/yylex.c:51\n    #5 0x427ca7 in yyparse /home/fuzz/github/flex_o/src/parse.c:1405\n    #6 0x41edea in readin /home/fuzz/github/flex_o/src/main.c:1490\n    #7 0x41af93 in flex_main /home/fuzz/github/flex_o/src/main.c:170\n    #8 0x41b282 in main /home/fuzz/github/flex_o/src/main.c:209\n    #9 0x7f3207e6d82f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f)\n\nSUMMARY: AddressSanitizer: 3 byte(s) leaked in 2 allocation(s).\n\n=================================================================\n==110421==ERROR: LeakSanitizer: detected memory leaks\n\nDirect leak of 2 byte(s) in 1 object(s) allocated from:\n    #0 0x7f320858230f in strdup (/usr/lib/x86_64-linux-gnu/libasan.so.2+0x6230f)\n    #1 0x420712 in xstrdup /home/fuzz/github/flex_o/src/misc.c:231\n    #2 0x435dd2 in ndinstal /home/fuzz/github/flex_o/src/sym.c:180\n    #3 0x441ee7 in flexscan scan.l:342\n    #4 0x43d4c0 in yylex /home/fuzz/github/flex_o/src/yylex.c:51\n    #5 0x427ca7 in yyparse /home/fuzz/github/flex_o/src/parse.c:1405\n    #6 0x41edea in readin /home/fuzz/github/flex_o/src/main.c:1490\n    #7 0x41af93 in flex_main /home/fuzz/github/flex_o/src/main.c:170\n    #8 0x41b282 in main /home/fuzz/github/flex_o/src/main.c:209\n    #9 0x7f3207e6d82f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f)\n\nDirect leak of 1 byte(s) in 1 object(s) allocated from:\n    #0 0x7f320858230f in strdup (/usr/lib/x86_64-linux-gnu/libasan.so.2+0x6230f)\n    #1 0x420712 in xstrdup /home/fuzz/github/flex_o/src/misc.c:231\n    #2 0x435dc3 in ndinstal /home/fuzz/github/flex_o/src/sym.c:180\n    #3 0x441ee7 in flexscan scan.l:342\n    #4 0x43d4c0 in yylex /home/fuzz/github/flex_o/src/yylex.c:51\n    #5 0x427ca7 in yyparse /home/fuzz/github/flex_o/src/parse.c:1405\n    #6 0x41edea in readin /home/fuzz/github/flex_o/src/main.c:1490\n    #7 0x41af93 in flex_main /home/fuzz/github/flex_o/src/main.c:170\n    #8 0x41b282 in main /home/fuzz/github/flex_o/src/main.c:209\n    #9 0x7f3207e6d82f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f)\n\nSUMMARY: AddressSanitizer: 3 byte(s) leaked in 2 allocation(s).\n")])])]),i("p",[e._v("testcase https://github.com/xcainiao/poc/blob/master/flex_memory_leaks_in_xstrdup")]),e._v(" "),i("h2",{attrs:{id:"analysis"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#analysis","aria-hidden":"true"}},[e._v("#")]),e._v(" analysis")]),e._v(" "),i("p",[e._v("gcc -o strdupxx strdupxx.c -g -fsanitize=address -lm -ldl -lpthread")]),e._v(" "),i("div",{staticClass:"language- extra-class"},[i("pre",{pre:!0,attrs:{class:"language-text"}},[i("code",[e._v('#include <stdio.h>\nvoid main()\n{\n    char *p1 = "m";\n    char *p2;\n    p2 = strdup(p1);\n    //free(p2);\n}\n')])])]),i("p",[e._v("output")]),e._v(" "),i("div",{staticClass:"language- extra-class"},[i("pre",{pre:!0,attrs:{class:"language-text"}},[i("code",[e._v("==20348==ERROR: LeakSanitizer: detected memory leaks\nDirect leak of 2 byte(s) in 1 object(s) allocated from:\n    #0 0x45daaf in __interceptor_strdup (/home/c/strdupxx+0x45daaf)\n    #1 0x4ac089 in main /home/c/strdupxx.c:6\n    #2 0x7fb8013fb82f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f)\nSUMMARY: AddressSanitizer: 2 byte(s) leaked in 1 allocation(s).\n")])])]),i("h2",{attrs:{id:"fuzz"}},[i("a",{staticClass:"header-anchor",attrs:{href:"#fuzz","aria-hidden":"true"}},[e._v("#")]),e._v(" fuzz")]),e._v(" "),i("p",[e._v("libfuzz")]),e._v(" "),i("div",{staticClass:"language- extra-class"},[i("pre",{pre:!0,attrs:{class:"language-text"}},[i("code",[e._v('#define filename  "./test.poc"\n//int main ()\nint LLVMFuzzerTestOneInput(char *data, int size)\n{\n    int argc = 2;\n    char *argv[2];\n    FILE* temfile = fopen(filename,"w");\n    fwrite(data, 1, size, temfile);\n    fclose(temfile);\n    argv[0] = "./flex";\n    argv[1] = "./test.poc";\n#if defined(ENABLE_NLS) && ENABLE_NLS\n#if HAVE_LOCALE_H\n    setlocale (LC_MESSAGES, "");\n        setlocale (LC_CTYPE, "");\n    textdomain (PACKAGE);\n    bindtextdomain (PACKAGE, LOCALEDIR);\n#endif\n#endif\n    return flex_main (argc, argv);\n}\n')])])])])}],!1,null,null,null);n.default=s.exports}}]);